<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Manageability of the QUIC Transport Protocol</title>

  
<style type="text/css">/*<![CDATA[*/
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

@media screen and (min-width: 1024px) {
  ul.toc, #rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 525px);
    width: 300px;
    z-index: 1;
  }
  #rfc\.toc {
    top: 15px;
  }
  ul.toc {
    top: 80px;
    overflow: auto;
  }

  body {
    padding-right: 350px;
  }
}

body {
  font: 15px "Helvetica Neue",Helvetica,Arial,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 130%;
  margin: 25px auto;
  max-width: 724px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
  font-size-adjust: 0.5;
  font-weight: 500;
  color: #333;
  line-height: 100%;
  margin: 0.8em 0 0.3em;
}
.title { font-size: 36px; }
h1 { font-size: 30px; }
h2 { font-size: 24px; }
h3, h4 { font-size: 18px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

ul.toc li {
  list-style: none;
  text-indent: -2.5em;
  padding-left: 2.5em;
  padding-bottom: 5px;
  margin: 0;
}
ul.toc ul {
  margin: 0;
}
/* xml2rfc nests ul directly inside ul which messes with the style badly */
ul.toc, ul.toc>ul, ul.toc ul>ul {
  margin: 0 0 0 1.5em;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header {
  width: 100%;
}
table.header td {
  border: none;
  background-color: transparent;
  color: black;
}
.filename {
  color: rgb(119, 119, 119);
  font-size: 23px;
  font-weight: normal;
  height: auto;
  line-height: 100%;
}
#rfc\.abstract+p {
  font-size: 20px;
  font-weight: 300;
  line-height: 130%;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure {
  font-style: italic;
  margin: 0 1.5em;
}

address {
  margin: 10px 0 0;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn {
  font-weight: bold;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

ol, ul, li, p {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
li, p {
  margin-left: 0;
}
address {
  font-style: normal;
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
/*]]>*/</style>


  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Notational Conventions">
<link href="#rfc.section.2" rel="Chapter" title="2 Features of the QUIC Wire Image">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 QUIC Packet Header Structure">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Integrity Protection of the Wire Image">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Connection ID and Rebinding">
<link href="#rfc.section.2.4" rel="Chapter" title="2.4 Packet Numbers">
<link href="#rfc.section.2.5" rel="Chapter" title="2.5 Initial Handshake and PMTUD">
<link href="#rfc.section.2.6" rel="Chapter" title="2.6 Version Negotiation and Greasing">
<link href="#rfc.section.3" rel="Chapter" title="3 Network-visible information about QUIC flows">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Identifying QUIC traffic">
<link href="#rfc.section.3.1.1" rel="Chapter" title="3.1.1 Identifying Negotiated Version">
<link href="#rfc.section.3.1.2" rel="Chapter" title="3.1.2 Rejection of Garbage Traffic">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Connection confirmation">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Application Identification">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Flow association">
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 Flow teardown">
<link href="#rfc.section.3.6" rel="Chapter" title="3.6 Round-trip time measurement">
<link href="#rfc.section.3.7" rel="Chapter" title="3.7 Packet loss measurement">
<link href="#rfc.section.3.8" rel="Chapter" title="3.8 Flow symmetry measurement">
<link href="#rfc.section.4" rel="Chapter" title="4 Specific Network Management Tasks">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Stateful treatment of QUIC traffic">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Passive network performance measurement and troubleshooting">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Server cooperation with load balancers">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 DDoS Detection and Mitigation">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 QoS support and ECMP">
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Contributors">
<link href="#rfc.section.8" rel="Chapter" title="8 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="9 References">
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.8.0 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Kuehlewind, M. and B. Trammell" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-quic-manageability-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2017-11-03" />
  <meta name="dct.abstract" content="This document discusses manageability of the QUIC transport protocol, focusing on caveats impacting network operations involving QUIC traffic. Its intended audience is network operators, as well as content providers that rely on the use of QUIC-aware middleboxes, e.g. for load balancing." />
  <meta name="description" content="This document discusses manageability of the QUIC transport protocol, focusing on caveats impacting network operations involving QUIC traffic. Its intended audience is network operators, as well as content providers that rely on the use of QUIC-aware middleboxes, e.g. for load balancing." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">M. Kuehlewind</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">B. Trammell</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">ETH Zurich</td>
</tr>
<tr>
<td class="left">Expires: May 7, 2018</td>
<td class="right">November 03, 2017</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Manageability of the QUIC Transport Protocol<br />
  <span class="filename">draft-ietf-quic-manageability-latest</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document discusses manageability of the QUIC transport protocol, focusing on caveats impacting network operations involving QUIC traffic. Its intended audience is network operators, as well as content providers that rely on the use of QUIC-aware middleboxes, e.g. for load balancing.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on May 7, 2018.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2017 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Notational Conventions</a>
</li>
</ul><li>2.   <a href="#rfc.section.2">Features of the QUIC Wire Image</a>
</li>
<ul><li>2.1.   <a href="#rfc.section.2.1">QUIC Packet Header Structure</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Integrity Protection of the Wire Image</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">Connection ID and Rebinding</a>
</li>
<li>2.4.   <a href="#rfc.section.2.4">Packet Numbers</a>
</li>
<li>2.5.   <a href="#rfc.section.2.5">Initial Handshake and PMTUD</a>
</li>
<li>2.6.   <a href="#rfc.section.2.6">Version Negotiation and Greasing</a>
</li>
</ul><li>3.   <a href="#rfc.section.3">Network-visible information about QUIC flows</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Identifying QUIC traffic</a>
</li>
<ul><li>3.1.1.   <a href="#rfc.section.3.1.1">Identifying Negotiated Version</a>
</li>
<li>3.1.2.   <a href="#rfc.section.3.1.2">Rejection of Garbage Traffic</a>
</li>
</ul><li>3.2.   <a href="#rfc.section.3.2">Connection confirmation</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Application Identification</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Flow association</a>
</li>
<li>3.5.   <a href="#rfc.section.3.5">Flow teardown</a>
</li>
<li>3.6.   <a href="#rfc.section.3.6">Round-trip time measurement</a>
</li>
<li>3.7.   <a href="#rfc.section.3.7">Packet loss measurement</a>
</li>
<li>3.8.   <a href="#rfc.section.3.8">Flow symmetry measurement</a>
</li>
</ul><li>4.   <a href="#rfc.section.4">Specific Network Management Tasks</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Stateful treatment of QUIC traffic</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Passive network performance measurement and troubleshooting</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Server cooperation with load balancers</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">DDoS Detection and Mitigation</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">QoS support and ECMP</a>
</li>
</ul><li>5.   <a href="#rfc.section.5">IANA Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Contributors</a>
</li>
<li>8.   <a href="#rfc.section.8">Acknowledgments</a>
</li>
<li>9.   <a href="#rfc.references">References</a>
</li>
<ul><li>9.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">QUIC <a href="#QUIC" class="xref">[QUIC]</a> is a new transport protocol currently under development in the IETF quic working group, focusing on support of semantics as needed for HTTP/2 <a href="#QUIC-HTTP" class="xref">[QUIC-HTTP]</a>. Based on current deployment practices, QUIC is encapsulated in UDP and encrypted by default. The current version of QUIC integrates TLS <a href="#QUIC-TLS" class="xref">[QUIC-TLS]</a> to encrypt all payload data and most control information. Given QUIC is an end-to-end transport protocol, all information in the protocol header, even that which can be inspected, is is not meant to be mutable by the network, and will therefore be integrity-protected to the extent possible.</p>
<p id="rfc.section.1.p.2">This document provides guidance for network operation on the management of QUIC traffic. This includes guidance on how to interpret and utilize information that is exposed by QUIC to the network as well as explaining requirement and assumptions that the QUIC protocol design takes toward the expected network treatment. It also discusses how common network management practices will be impacted by QUIC.</p>
<p id="rfc.section.1.p.3">Of course, network management is not a one-size-fits-all endeavour: practices considered necessary or even mandatory within enterprise networks with certain compliance requirements, for example, would be impermissible on other networks without those requirements. This document therefore does not make any specific recommendations as to which practices should or should not be applied; for each practice, it describes what is and is not possible with the QUIC transport protocol as defined.</p>
<p id="rfc.section.1.p.4">QUIC is at the moment very much a moving target. This document refers the state of the QUIC working group drafts as well as to changes under discussion, via issues and pull requests in GitHub current as of the time of writing.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#notational-conventions" id="notational-conventions">Notational Conventions</a>
</h1>
<p id="rfc.section.1.1.p.1">The words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;SHOULD&#8221;, and &#8220;MAY&#8221; are used in this document.  It&#8217;s not shouting; when these words are capitalized, they have a special meaning as defined in <a href="#RFC2119" class="xref">[RFC2119]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#sec-wire-image" id="sec-wire-image">Features of the QUIC Wire Image</a>
</h1>
<p id="rfc.section.2.p.1">In this section, we discusses those aspects of the QUIC transport protocol that have an impact on the design and operation of devices that forward QUIC packets.  Here, we are concerned primarily with QUIC&#8217;s unencrypted wire image, which we define as the information available in the packet header in each QUIC packet, and the dynamics of that information. Since QUIC is a versioned protocol, also the wire image of the header format can change. However, at least the mechanism by which a receiver can determine which version is used and the meaning and location of fields used in the version negotiation process need to be fixed.</p>
<p id="rfc.section.2.p.2">This document is focused on the protocol as presently defined in <a href="#QUIC" class="xref">[QUIC]</a> and <a href="#QUIC-TLS" class="xref">[QUIC-TLS]</a>, and will change to track those documents.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#public-header" id="public-header">QUIC Packet Header Structure</a>
</h1>
<p id="rfc.section.2.1.p.1">The QUIC packet header is under active development; see section 5 of <a href="#QUIC" class="xref">[QUIC]</a> for the present header structure.</p>
<p id="rfc.section.2.1.p.2">The first bit of the QUIC header indicates the presence of a long header that exposes more information than the short header. The long header is used during connection establishment, including version negotiation, server retry, and 0-RTT data while the short header is used after the handshake and therefore on most data packets. The fields and location of these fields in the QUIC long header are invariant for future versions of QUIC, although  future versions of QUIC may provide additional fields in the long header.. In the current version of QUIC the long header is fixed-length, containing a header Type, a 64-bit Connection ID, a 32-bit Packet Number, and a 32-bit Version. The short header is variable length, where the bits after the Header Form bit indicate the presence of the Connection ID, and the length of the packet number.</p>
<p id="rfc.section.2.1.p.3">The following information may be exposed in the packet header:</p>
<p></p>

<ul>
<li>header type: the long header has a 7-bit packet type field following the Header Form bit. The current version of QUIC defines five packet types, namely Version Negotiation, Initial, Retry, Handshake, 0-RTT Protected.</li>
<li>connection ID: The connection ID is always present on the long and optionally present on the short header indicated by the Connection ID Flag. If present at the short header it at the same position then for the long header. The position and length pf the congestion ID itself as well as the Connection ID flag in the short header is fixed for all versions of QUIC. The connection ID identifies the connection associated with a QUIC packet, for load-balancing and NAT rebinding purposes; see <a href="#sec-loadbalancing" class="xref">Section 4.3</a> and <a href="#rebinding" class="xref">Section 2.3</a>. Therefore it is also expected that the Connection ID will either be present on all packets of a flow or none of the short header packets. However, this field is under endpoint control and there is no protocol mechanism that hinders the sending endpoint to revise its decision about exposing the Connection ID at any time during the connection.</li>
<li>packet number: Every packet has an associated packet number. The packet number increases with each packet, and the least-significant bits of the packet number are present on each packet. In the short header the length of the exposed packet number field is defined by the (short) header type and can either be 8, 16, or 32 bits. See <a href="#packetnumber" class="xref">Section 2.4</a>.</li>
<li>version number: The version number is present on the long headers and identifies the version used for that packet, expect for the Version negotiation packet. The version negotiation packet is fixed for all version of QUIC and contains a list of versions that is supported by the sender. The version in the version field of the Version Negotiation packet is the reflected version of the Initial packet and is therefore explicitly not supported by the sender.</li>
<li>key phase: The Key Phase bit identifies the key used to encrypt the packet.</li>
</ul>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#wire-integrity" id="wire-integrity">Integrity Protection of the Wire Image</a>
</h1>
<p id="rfc.section.2.2.p.1">As soon as the cryptographic context is established, all information in the QUIC header, including those exposed in the packet header, is integrity protected.  Further, information that were sent and exposed in previous packets when the cryptographic context was established yet, e.g. for the cryptographic initial handshake itself, will be validated later during the cryptographic handshake, such as the version number.  Therefore, devices on path MUST NOT change any information or bits in QUIC packet headers. As alteration of header information would cause packet drop due to a failed integrity check at the receiver, or can even lead to connection termination.</p>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> <a href="#rebinding" id="rebinding">Connection ID and Rebinding</a>
</h1>
<p id="rfc.section.2.3.p.1">The connection ID in the QUIC packer header is used to allow routing of QUIC packets at load balancers on other than five-tuple information, ensuring that related flows are appropriately balanced together; and to allow rebinding of a connection after one of the endpoint&#8217;s addresses changes - usually the client&#8217;s, in the case of the HTTP binding. The client set a Connection ID in the Initial Client packet that will be used during the handshake. A new connection ID is then provided by the server during connection establishment, that will be used in the short header after the handshake. Further a server might provide additional connection IDs that can the used by the client at any time during the connection. Therefore if a flow changes one of its IP addresses it may keep the same connection ID, or the connection ID may also change together with the IP address migration, avoiding linkability; see Section 7.6 of <a href="#QUIC" class="xref">[QUIC]</a>.</p>
<h1 id="rfc.section.2.4">
<a href="#rfc.section.2.4">2.4.</a> <a href="#packetnumber" id="packetnumber">Packet Numbers</a>
</h1>
<p id="rfc.section.2.4.p.1">The packet number field is always present in the QUIC packet header. The packet number exposes the least significant 32, 16, or 8 bits of an internal packet counter per flow direction that increments with each packet sent. This packet counter is initialized with a random 31-bit initial value at the start of a connection.</p>
<p id="rfc.section.2.4.p.2">Unlike TCP sequence numbers, this packet number increases with every packet, including those containing only acknowledgment or other control information.  Indeed, whether a packet contains user data or only control information is intentionally left unexposed to the network. The packet number increases with every packet but they sender may skip packet numbers.</p>
<p id="rfc.section.2.4.p.3">While loss detection in QUIC is based on packet numbers, congestion control by default provides richer information than vanilla TCP does. Especially, QUIC does not rely on duplicated ACKs, making it more tolerant of packet re-ordering.</p>
<h1 id="rfc.section.2.5">
<a href="#rfc.section.2.5">2.5.</a> <a href="#initial-handshake-and-pmtud" id="initial-handshake-and-pmtud">Initial Handshake and PMTUD</a>
</h1>
<p id="rfc.section.2.5.p.1">[Editor&#8217;s note: text needed.]</p>
<h1 id="rfc.section.2.6">
<a href="#rfc.section.2.6">2.6.</a> <a href="#version-negotiation-and-greasing" id="version-negotiation-and-greasing">Version Negotiation and Greasing</a>
</h1>
<p id="rfc.section.2.6.p.1">Version negotiation is not protected, given the used protection mechanism can change with the version.  However, the choices provided in the list of version in the Version Negotiation packet will be validated as soon as the cryptographic context has been established. Therefore any manipulation of this list will be detected and will cause the endpoints to terminate the connection.</p>
<p id="rfc.section.2.6.p.2">Also note that the list of versions in the Version Negotiation packet may contain reserved versions. This mechanism is used to avoid ossification in the implementation on the selection mechanism. Further, a client may send a Initial Client packet with a reserved version number to trigger version negotiation. In the Version Negotiation packet the connection ID and packet number of the Client Initial packet are reflected to provide a proof of return-routability. Therefore changing these information will also cause the connection to fail.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#network-visible-information-about-quic-flows" id="network-visible-information-about-quic-flows">Network-visible information about QUIC flows</a>
</h1>
<p id="rfc.section.3.p.1">This section addresses the different kinds of observations and inferences that can be made about QUIC flows by a passive observer in the network based on the wire image in <a href="#sec-wire-image" class="xref">Section 2</a>. Here we assume a bidirectional observer (one that can see packets in both directions in the sequence in which they are carried on the wire) unless noted.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#sec-identifying" id="sec-identifying">Identifying QUIC traffic</a>
</h1>
<p id="rfc.section.3.1.p.1">The QUIC wire image is not specifically designed to be distinguishable from other UDP traffic.</p>
<p id="rfc.section.3.1.p.2">The only application binding currently defined for QUIC is HTTP <a href="#QUIC-HTTP" class="xref">[QUIC-HTTP]</a>. HTTP over QUIC uses UDP port 443 by default, although URLs referring to resources available over HTTP over QUIC may specify alternate port numbers. Simple assumptions about whether a given flow is using QUIC based upon a UDP port number may therefore not hold; see also <a href="#RFC7605" class="xref">[RFC7605]</a> section 5.</p>
<h1 id="rfc.section.3.1.1">
<a href="#rfc.section.3.1.1">3.1.1.</a> <a href="#identifying-negotiated-version" id="identifying-negotiated-version">Identifying Negotiated Version</a>
</h1>
<p id="rfc.section.3.1.1.p.1">An in-network observer assuming that a set of packets belongs to a QUIC flow can infer the version number in use by observing the handshake: an Initial packet with a given version from a client to which a server responds with an Initial packet with the same version implies acceptance of that version.</p>
<p id="rfc.section.3.1.1.p.2">Negotiated version cannot be identified for flows for which a handshake is not observed, such as in the case of NAT rebinding; however, these flows can be associated with flows for which a version has been identified; see <a href="#sec-flow-association" class="xref">Section 3.4</a>.</p>
<p id="rfc.section.3.1.1.p.3">In the rest of this section, we discuss only packets belonging to Version 1 QUIC flows, and assume that these packets have been identified as such through the observation of a version negotiation.</p>
<h1 id="rfc.section.3.1.2">
<a href="#rfc.section.3.1.2">3.1.2.</a> <a href="#sec-garbage" id="sec-garbage">Rejection of Garbage Traffic</a>
</h1>
<p id="rfc.section.3.1.2.p.1">A related question is whether a first packet of a given flow on known QUIC-associated port is a valid QUIC packet, in order to support in-network filtering of garbage UDP packets (reflection attacks, random backscatter). While heuristics based on the first byte of the packet (packet type) could be used to separate valid from invalid first packet types, the deployment of such heuristics is not recommended, as packet types may have different meanings in future versions of the protocol.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#sec-confirm" id="sec-confirm">Connection confirmation</a>
</h1>
<p id="rfc.section.3.2.p.1">Connection establishment uses Initial, Handshake, and Retry packets containing a TLS handshake on Stream 0. Connection establishment can therefore be detected using heuristics similar to those used to detect TLS over TCP. A client using 0-RTT connection may also send data packets in 0-RTT Protected packets directly after the Initial packet containing the TLS Client Hello.  Since these packets may be reordered in the network, note that 0-RTT Protected data packets may be seen before the Initial packet. Note that only clients send Initial packets, so the sides of a connection can be distinguished by QUIC packet type in the handshake.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#sec-server" id="sec-server">Application Identification</a>
</h1>
<p id="rfc.section.3.3.p.1">The cleartext TLS handshake may contain Server Name Indication (SNI) <a href="#RFC6066" class="xref">[RFC6066]</a>, by which the client reveals the name of the server it intends to connect to, in order to allow the server to present a certificate based on that name. It may also contain information from Application-Layer Protocol Negotiation (ALPN) <a href="#RFC7301" class="xref">[RFC7301]</a>, by which the client exposes the names of application-layer protocols it supports; an observer can deduce that one of those protocols will be used if the connection continues.</p>
<p id="rfc.section.3.3.p.2">Work is currently underway in the TLS working group to encrypt the SNI in TLS 1.3 <a href="#TLS-ENCRYPT-SNI" class="xref">[TLS-ENCRYPT-SNI]</a>, reducing the information available in the SNI to the name of a fronting service, which can generally be identified by the IP address of the server anyway. If used with QUIC, this would make SNI-based application identification impossible through passive measurement.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#sec-flow-association" id="sec-flow-association">Flow association</a>
</h1>
<p id="rfc.section.3.4.p.1">The QUIC Connection ID (see <a href="#rebinding" class="xref">Section 2.3</a>) is designed to allow an on-path device such as a load-balancer to associate two flows as identified by five-tuple when the address and port of one of the endpoints changes; e.g. due to NAT rebinding or server IP address migration. An observer keeping flow state can associate a connection ID with a given flow, and can associate a known flow with a new flow when when observing a packet sharing a connection ID and one endpoint address (IP address and port) with the known flow.</p>
<p id="rfc.section.3.4.p.2">The connection ID to be used for a long-running flow is chosen by the server (see <a href="#QUIC" class="xref">[QUIC]</a> section 5.6) during the handshake. This value should be treated as opaque; see <a href="#sec-loadbalancing" class="xref">Section 4.3</a> for caveats regarding connection ID selection at servers.</p>
<h1 id="rfc.section.3.5">
<a href="#rfc.section.3.5">3.5.</a> <a href="#sec-teardown" id="sec-teardown">Flow teardown</a>
</h1>
<p id="rfc.section.3.5.p.1">The QUIC does not expose the end of a connection; the only indication to on-path devices that a flow has ended is that packets are no longer observed. Stateful devices on path such as NATs and firewalls must therefore use idle timeouts to determine when to drop state for QUIC flows.</p>
<p id="rfc.section.3.5.p.2">Changes to this behavior are currently under discussion:  see https://github.com/quicwg/base-drafts/issues/602.</p>
<h1 id="rfc.section.3.6">
<a href="#rfc.section.3.6">3.6.</a> <a href="#sec-rtt" id="sec-rtt">Round-trip time measurement</a>
</h1>
<p id="rfc.section.3.6.p.1">Round-trip time of QUIC flows can be inferred by observation once per flow, during the handshake, as in passive TCP measurement; this requires parsing of the QUIC packet header and the cleartext TLS handshake on stream 0.</p>
<p id="rfc.section.3.6.p.2">In the common case, the delay between the Initial packet containing the TLS Client Hello and the Handshake packet containing the TLS Server Hello represents the RTT component on the path between the observer and the server.  The delay between the TLS Server Hello and the Handshake packet containing the TLS Finished message sent by the client represents the RTT component on the path between the observer and the client. While the client may send 0-RTT Protected packets after the Initial packet during 0-RTT connection re-establishment, these can be ignored for RTT measurement purposes.</p>
<p id="rfc.section.3.6.p.3">Handshake RTT can be measured by adding the client-to-observer and observer-to-server RTT components together. This measurement necessarily includes any transport and application layer delay at both sides.</p>
<p id="rfc.section.3.6.p.4">QUIC does not expose any acknowledgement or timestamping information in its wire image. This makes passive measurement of more than one RTT sample per flow, or passive measurement of changes in RTT during a flow&#8217;s lifetime, impossible in the general case.</p>
<p id="rfc.section.3.6.p.5">Changes to this behavior are currently under discussion:  see https://github.com/quicwg/base-drafts/issues/631.</p>
<h1 id="rfc.section.3.7">
<a href="#rfc.section.3.7">3.7.</a> <a href="#sec-loss" id="sec-loss">Packet loss measurement</a>
</h1>
<p id="rfc.section.3.7.p.1">All QUIC packets carry packet numbers in cleartext, and while the protocol allows packet numbers to be skipped, skipping is not recommended in the general case. This allows the trivial one-sided estimation of packet loss and reordering between the sender and a given observation point (&#8220;upstream loss&#8221;). However, since retransmissions are not identifiable as such, loss between an observation point and the receiver (&#8220;downstream loss&#8221;) cannot be reliably estimated.</p>
<h1 id="rfc.section.3.8">
<a href="#rfc.section.3.8">3.8.</a> <a href="#sec-symmetry" id="sec-symmetry">Flow symmetry measurement</a>
</h1>
<p id="rfc.section.3.8.p.1">QUIC explicitly exposes which side of a connection is a client and which side is a server during the handshake. In addition, the symmerty of a flow (whether primarily client-to-server, primarily server-to-client, or roughly bidirectional, as input to basic traffic classification techniques) can be inferred through the measurement of data rate in each direction. While QUIC traffic is protected and ACKS may be padded, padding is not required.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#specific-network-management-tasks" id="specific-network-management-tasks">Specific Network Management Tasks</a>
</h1>
<p id="rfc.section.4.p.1">In this section, we address specific network management and measurement techniques and how QUIC&#8217;s design impacts them.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#sec-stateful" id="sec-stateful">Stateful treatment of QUIC traffic</a>
</h1>
<p id="rfc.section.4.1.p.1">Stateful treatment of QUIC traffic is possible through QUIC traffic and version identification (<a href="#sec-identifying" class="xref">Section 3.1</a>) and observation of the handshake for connection confirmation (<a href="#sec-confirm" class="xref">Section 3.2</a>). The lack of any visible end-of-flow signal (<a href="#sec-teardown" class="xref">Section 3.5</a>) means that this state must be purged either through timers or through least-recently-used eviction, depending on application requirements.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#passive-network-performance-measurement-and-troubleshooting" id="passive-network-performance-measurement-and-troubleshooting">Passive network performance measurement and troubleshooting</a>
</h1>
<p id="rfc.section.4.2.p.1">Extremely limited loss and RTT measurement are possible by passive observation of QUIC traffic; see <a href="#sec-rtt" class="xref">Section 3.6</a> and <a href="#sec-loss" class="xref">Section 3.7</a>.</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#sec-loadbalancing" id="sec-loadbalancing">Server cooperation with load balancers</a>
</h1>
<p id="rfc.section.4.3.p.1">In the case of content distribution networking architectures including load balancers, the connection ID provides a way for the server to signal information about the desired treatment of a flow to the load balancers.</p>
<p id="rfc.section.4.3.p.2">Server-generated Connection IDs must not encode any information other that that needed to route packets to the appropriate backend server(s): typically the identity of the backend server or pool of servers, if the data-center&#8217;s load balancing system keeps &#8220;local&#8221; state of all flows itself.  Care must be exercised to ensure that the information encoded in the Connection ID is not sufficient to identify unique end users. Note that by encoding routing information in the Connection ID, load balancers open up a new attack vector that allows bad actors to direct traffic at a specific backend server or pool.  It is therefore recommended that Server-Generated Connection ID includes a cryptographic MAC that the load balancer pool server are able to identify and discard packets featuring an invalid MAC.</p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> <a href="#sec-ddos-dec" id="sec-ddos-dec">DDoS Detection and Mitigation</a>
</h1>
<p id="rfc.section.4.4.p.1">Current practices in detection and mitigation of Distributed Denial of Service (DDoS) attacks generally involve passive measurement using network flow data <a href="#RFC7011" class="xref">[RFC7011]</a>, classification of traffic into &#8220;good&#8221; (productive) and &#8220;bad&#8221; (DoS) flows, and filtering of these bad flows in a &#8220;scrubbing&#8221; environment. Key to successful DDoS mitigation is efficient classification of this traffic.</p>
<p id="rfc.section.4.4.p.2">Limited first-packet garbage detection as in <a href="#sec-garbage" class="xref">Section 3.1.2</a> and stateful tracking of QUIC traffic as in <a href="#sec-stateful" class="xref">Section 4.1</a> above can be used in this classification step. For traffic where the classification step did not observe a QUIC handshake, the presence of packets carrying the same Connection ID in both directions is a further indication of legitimate traffic. Note that these classification techniques help only against floods of garbage traffic, not against DDoS attacks using legitimate QUIC clients.</p>
<p id="rfc.section.4.4.p.3">Note that the use of a connection ID to support connection migration renders 5-tuple based filtering insufficient, and requires more state to be maintained by DDoS defense systems. However, it is questionable if connection migrations needs to be supported in a DDOS attack. If the connection migration is not visible to the network that performs the DDoS detection, an active, migrated QUIC connection may be blocked by such a system under attack. However, a defense system might simply rely on the fast resumption mechanism provided by QUIC. See also https://github.com/quicwg/base-drafts/issues/203</p>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> <a href="#qos-support-and-ecmp" id="qos-support-and-ecmp">QoS support and ECMP</a>
</h1>
<p id="rfc.section.4.5.p.1">[EDITOR&#8217;S NOTE: this is a bit speculative; keep?]</p>
<p id="rfc.section.4.5.p.2">QUIC does not provide any additional information on requirements on Quality of Service (QoS) provided from the network. QUIC assumes that all packets with the same 5-tuple {dest addr, source addr, protocol, dest port, source port} will receive similar network treatment.  That means all stream that are multiplexed over the same QUIC connection require the same network treatment and are handled by the same congestion controller. If differential network treatment is desired, multiple QUIC connections to the same server might be used, given that establishing a new connection using 0-RTT support is cheap and fast.</p>
<p id="rfc.section.4.5.p.3">QoS mechanisms in the network MAY also use the connection ID for service differentiation, as a change of connection ID is bound to a change of address which anyway is likely to lead to a re-route on a different path with different network characteristics.</p>
<p id="rfc.section.4.5.p.4">Given that QUIC is more tolerant of packet re-ordering than TCP (see <a href="#packetnumber" class="xref">Section 2.4</a>), Equal-cost multi-path routing (ECMP) does not necessarily need to be flow based.  However, 5-tuple (plus eventually connection ID if present) matching is still beneficial for QoS given all packets are handled by the same congestion controller.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a>
</h1>
<p id="rfc.section.5.p.1">This document has no actions for IANA.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a>
</h1>
<p id="rfc.section.6.p.1">Supporting manageability of QUIC traffic inherently involves tradeoffs with the confidentiality of QUIC&#8217;s control information; this entire document is therefore security-relevant.</p>
<p id="rfc.section.6.p.2">Some of the properties of the QUIC header used in network management are irrelevant to application-layer protocol operation and/or user privacy. For example, packet number exposure (and echo, as proposed in this document), as well as connection establishment exposure for 1-RTT establishment, make no additional information about user traffic available to devices on path.</p>
<p id="rfc.section.6.p.3">At the other extreme, supporting current traffic classification methods that operate through the deep packet inspection (DPI) of application-layer headers are directly antithetical to QUIC&#8217;s goal to provide confidentiality to its application-layer protocol(s); in these cases, alternatives must be found.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#contributors" id="contributors">Contributors</a>
</h1>
<p id="rfc.section.7.p.1">Dan Druta contributed text to <a href="#sec-ddos-dec" class="xref">Section 4.4</a>. Igor Lubashev contributed text to <a href="#sec-loadbalancing" class="xref">Section 4.3</a> on the use of the connection ID for load balancing.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#acknowledgments" id="acknowledgments">Acknowledgments</a>
</h1>
<p id="rfc.section.8.p.1">This work is partially supported by the European Commission under Horizon 2020 grant agreement no. 688421 Measurement and Architecture for a Middleboxed Internet (MAMI), and by the Swiss State Secretariat for Education, Research, and Innovation under contract no. 15.0268. This support does not imply endorsement.</p>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">9.1.</a> Normative References</h1>
<table><tbody><tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr></tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">9.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="Ding2015">[Ding2015]</b></td>
<td class="top">
<a>Ding, H.</a> and <a>M. Rabinovich</a>, "<a href="http://www.sigcomm.org/sites/default/files/ccr/papers/2015/July/0000000-0000002.pdf">TCP Stretch Acknowledgments and Timestamps - Findings and Impliciations for Passive RTT Measurement (ACM Computer Communication Review)</a>", July 2015.</td>
</tr>
<tr>
<td class="reference"><b id="IPIM">[IPIM]</b></td>
<td class="top">
<a>Allman, M.</a>, <a>Beverly, R.</a> and <a>B. Trammell</a>, "<a href="https://arxiv.org/abs/1612.02902">In-Protocol Internet Measurement (arXiv preprint 1612.02902)</a>", December 2016.</td>
</tr>
<tr>
<td class="reference"><b id="QUIC">[QUIC]</b></td>
<td class="top">
<a>Iyengar, J.</a> and <a>M. Thomson</a>, "<a href="https://tools.ietf.org/html/draft-ietf-quic-transport-07">QUIC: A UDP-Based Multiplexed and Secure Transport</a>", Internet-Draft draft-ietf-quic-transport-07, October 2017.</td>
</tr>
<tr>
<td class="reference"><b id="QUIC-HTTP">[QUIC-HTTP]</b></td>
<td class="top">
<a>Bishop, M.</a>, "<a href="https://tools.ietf.org/html/draft-ietf-quic-http-07">Hypertext Transfer Protocol (HTTP) over QUIC</a>", Internet-Draft draft-ietf-quic-http-07, October 2017.</td>
</tr>
<tr>
<td class="reference"><b id="QUIC-TLS">[QUIC-TLS]</b></td>
<td class="top">
<a>Thomson, M.</a> and <a>S. Turner</a>, "<a href="https://tools.ietf.org/html/draft-ietf-quic-tls-07">Using Transport Layer Security (TLS) to Secure QUIC</a>", Internet-Draft draft-ietf-quic-tls-07, October 2017.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6066">[RFC6066]</b></td>
<td class="top">
<a>Eastlake 3rd, D.</a>, "<a href="https://tools.ietf.org/html/rfc6066">Transport Layer Security (TLS) Extensions: Extension Definitions</a>", RFC 6066, DOI 10.17487/RFC6066, January 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7011">[RFC7011]</b></td>
<td class="top">
<a>Claise, B.</a>, <a>Trammell, B.</a> and <a>P. Aitken</a>, "<a href="https://tools.ietf.org/html/rfc7011">Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of Flow Information</a>", STD 77, RFC 7011, DOI 10.17487/RFC7011, September 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7301">[RFC7301]</b></td>
<td class="top">
<a>Friedl, S.</a>, <a>Popov, A.</a>, <a>Langley, A.</a> and <a>E. Stephan</a>, "<a href="https://tools.ietf.org/html/rfc7301">Transport Layer Security (TLS) Application-Layer Protocol Negotiation Extension</a>", RFC 7301, DOI 10.17487/RFC7301, July 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7605">[RFC7605]</b></td>
<td class="top">
<a>Touch, J.</a>, "<a href="https://tools.ietf.org/html/rfc7605">Recommendations on Using Assigned Transport Port Numbers</a>", BCP 165, RFC 7605, DOI 10.17487/RFC7605, August 2015.</td>
</tr>
<tr>
<td class="reference"><b id="TLS-ENCRYPT-SNI">[TLS-ENCRYPT-SNI]</b></td>
<td class="top">
<a>Huitema, C.</a> and <a>E. Rescorla</a>, "<a href="https://tools.ietf.org/html/draft-ietf-tls-sni-encryption-00">SNI Encryption in TLS Through Tunneling</a>", Internet-Draft draft-ietf-tls-sni-encryption-00, August 2017.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Mirja Kuehlewind</span> 
	  <span class="n hidden">
		<span class="family-name">Kuehlewind</span>
	  </span>
	</span>
	<span class="org vcardline">ETH Zurich</span>
	<span class="adr">
	  <span class="vcardline">Gloriastrasse 35</span>

	  <span class="vcardline">
		<span class="locality">8092 Zurich</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Switzerland</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mirja.kuehlewind@tik.ee.ethz.ch">mirja.kuehlewind@tik.ee.ethz.ch</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Brian Trammell</span> 
	  <span class="n hidden">
		<span class="family-name">Trammell</span>
	  </span>
	</span>
	<span class="org vcardline">ETH Zurich</span>
	<span class="adr">
	  <span class="vcardline">Gloriastrasse 35</span>

	  <span class="vcardline">
		<span class="locality">8092 Zurich</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Switzerland</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ietf@trammell.ch">ietf@trammell.ch</a></span>

  </address>
</div>

</body>
</html>
